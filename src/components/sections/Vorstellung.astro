---
import { Image } from 'astro:assets';
import TeamPhoto from '../../assets/images/team.png';

type Highlight = { title: string; description?: string };

type TeamMember = {
  name: string;
  role: string;
  image?: ImageMetadata;
};

type CTA = { label: string; href: string };

type Props = {
  id?: string;
  heading: string;
  subtitle?: string;
  intro?: string;
  highlights?: Highlight[];
  team?: TeamMember[];
  cta?: CTA;
};

const {
  id = 'vorstellung',
  heading,
  subtitle = '',
  intro = '',
  highlights = [],
  team = [],
  cta,
} = Astro.props as Props;

const hotspots = [
  {
    name: 'Dr. Lubudu',
    role: 'Zahnmedizinerin',
    top: '50%',
    left: '20%',
    height: '55%',
    delay: '100ms',
  },
  {
    name: 'Dr. Preiser',
    role: 'Notfallmedizinerin',
    top: '45%',
    left: '40%',
    height: '52%',
    delay: '300ms',
  },
  {
    name: 'Dr.  Hermann',
    role: 'Praxismanager',
    top: '50%',
    left: '55%',
    height: '80%',
    delay: '500ms',
  },
  {
    name: 'Zulana',
    role: 'Tiermedizinischer Fachangestellter',
    top: '50%',
    left: '70%',
    height: '60%',
    delay: '700ms',
  },
];
---

<section id={id} aria-labelledby={`${id}-heading`} class="bg-base-100">
  <div class="mx-auto max-w-screen-xl px-4 py-16 lg:px-8 lg:py-24">
    <div class="flex flex-col gap-10 lg:grid lg:grid-cols-2 lg:items-center lg:gap-12">
      <div class="flex flex-col gap-6 lg:col-start-1 lg:row-start-1">
        <h2
          id={`${id}-heading`}
          class="font-header decoration-primary-content max-w-3xl text-4xl/tight text-balance underline underline-offset-6 sm:text-4xl/tight"
          data-animate="fade-up"
        >
          {heading}
        </h2>
        <p class="text-base-content/80 mt-3" data-animate="fade-up" data-delay="100">{subtitle}</p>
      </div>

      <div
        class="border-primary/40 relative order-2 overflow-visible rounded-3xl border-6 lg:order-none lg:col-start-2 lg:row-span-2"
        data-animate="scale"
        data-delay="200"
      >
        <div class="group relative">
          <div
            class="badge-marker pointer-events-none absolute z-20 opacity-0 transition-opacity duration-500 group-hover:opacity-0 sm:opacity-0 lg:opacity-100"
            style="top: 10%; left: 16%;"
          >
            <div class="badge badge-xl bg-warning/30 round badge-pulse rounded-2xl"></div>
          </div>
          <Image
            src={TeamPhoto}
            alt="Das Team der Tierarztpraxis Fellfreunde am Rhein"
            width={800}
            height={800}
            class="object-cover-base-300 border-primary h-full w-full rounded-2xl"
            format="webp"
          />
          {
            hotspots.map((spot, index) => (
              <button
                class="group absolute size-20 -translate-x-1/2 -translate-y-1/2 bg-transparent group-hover:opacity-100 hover:scale-105 lg:opacity-0"
                style={`top:${spot.top};left:${spot.left};height:${spot.height};transition: opacity 500ms ease ${spot.delay}, transform 300ms ease 0s;`}
                aria-label={`${spot.name} â€“ ${spot.role}`}
              >
                <span
                  class={`bg-secondary/70 text-base-content absolute left-1/2 -translate-x-1/2 rounded-full px-3 py-1 text-sm font-medium whitespace-nowrap shadow-lg transition-opacity duration-500 group-hover:opacity-100 sm:opacity-100 lg:opacity-0 ${
                    index === 1 || index === 3
                      ? 'top-full mt-2 sm:top-auto sm:bottom-full sm:mt-0 sm:mb-2'
                      : 'bottom-full mb-2'
                  }`}
                  style={`transition-delay:${spot.delay};`}
                >
                  {spot.name}
                </span>
              </button>
            ))
          }
        </div>
      </div>

      {
        highlights.length > 0 && (
          <div class="order-3 flex flex-col flex-wrap items-center gap-4 sm:flex-row lg:order-none lg:col-start-1 lg:row-start-2">
            {highlights.map((item) => (
              <div class="bg-base-200/70 text-base-content flex w-4/5 flex-col items-center gap-1 rounded-xl px-4 py-3 text-center sm:w-auto sm:flex-row sm:gap-2 sm:px-5 sm:py-3">
                <span class="text-sm font-semibold sm:text-base">{item.title}</span>
                {item.description && (
                  <span class="text-base-content/70 text-xs sm:text-sm">{item.description}</span>
                )}
              </div>
            ))}
          </div>
        )
      }
    </div>
  </div>
</section>

<style>
  .badge-marker {
    transform: translate(-50%, -50%);
  }

  .badge-pulse {
    position: relative;
    isolation: isolate;
    animation: badgePulse 5s ease-in-out infinite;
  }

  .badge-pulse::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    border: 2px solid lightsalmon;
    opacity: 0;
    transform: scale(1);
    pointer-events: none;
    z-index: -1;
    animation: badgePulseRing 5s ease-in-out infinite;
  }

  @keyframes badgePulse {
    0%,
    100% {
      transform: scale(0.8);
    }
    50% {
      transform: scale(1.08);
    }
  }

  @keyframes badgePulseRing {
    0% {
      opacity: 0;
      transform: scale(0.9);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.35);
    }
    100% {
      opacity: 0;
      transform: scale(1.45);
    }
  }
</style>
